<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"><![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"><![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"><![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"><!--<![endif]-->
<head>
    <!-- Website Template designed by www.downloadwebsitetemplates.co.uk -->
    <!-- Modified to fit Cryogen.-->
    <meta charset="UTF-8">
    <title>williamgrimes.xyz: Kobo - Annotation Extractor</title>
    
<meta name="keywords" content="filesystem,bash,machine-learning,whitepaper,project,linux,text-mining,computer-vision,NLP,bitcoin,illegal-fishing,kobo,nltk,notes,notification,python,anacron,kaggle,unix,segmentation">

<meta name="description" content="Electronic ink (e-ink) displays are composed of an array of tiny micro-capsules embedded in a layer between two electrodes. Each micro-capsule in the array contains both positively charged white particles, and negatively charged black particles. These particles are suspended in a transparent oil. When a voltage is applied across the micro-capsule, the black and white particles separate. With either the black particles or white particles moving to the top of the micro-capsule, creating a white or black dot depending on the charge [1].">

<meta property="og:description" content="Electronic ink (e-ink) displays are composed of an array of tiny micro-capsules embedded in a layer between two electrodes. Each micro-capsule in the array contains both positively charged white particles, and negatively charged black particles. These particles are suspended in a transparent oil. When a voltage is applied across the micro-capsule, the black and white particles separate. With either the black particles or white particles moving to the top of the micro-capsule, creating a white or black dot depending on the charge [1].">

<meta property="og:url" content="http://williamgrimes.xyz/posts/2023-01-17-kobo-annotation-extractor/" />
<meta property="og:title" content="Kobo - Annotation Extractor" />
<meta property="og:type" content="article" />

    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/ico/apple-touch-icon-144.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/ico/apple-touch-icon-114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/ico/apple-touch-icon-72.png">
    <link rel="apple-touch-icon-precomposed" href="images/ico/apple-touch-icon-57.png">
    <link rel="shortcut icon" href="images/ico/favicon.png">
    <link rel="icon" href="/img/headshot.png">
    <link href="/fonts/sample.css" rel="stylesheet" type="text/css" >
    <!--[if IE]><![endif]-->
    <link href="/css/buttons.css" rel="stylesheet" type="text/css" />
    <link href="/css/menu.css" rel="stylesheet" type="text/css" />
    <link href="/css/reset.css" rel="stylesheet" type="text/css" />
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/css/typography.css" rel="stylesheet" type="text/css" />
    <link href="/css/highlightjs.min.css" rel="stylesheet" type="text/css" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/tomorrow-night-eighties.min.css"> -->
    <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>

<div id="left">

    <p id="logo">
        <a title="williamgrimes.xyz" href="/">
            <!-- <span class="fa fa-rocket"></span> -->
            <br>
            <img class="icon" src="/img/headshot.png">
            <br>
            <span class="author">William Grimes</span>
            <br>
            <span class="title">(innovate iterate integrate)</span>
        </a>
    </p>

    <div id="socialmedia" class="clearfix">
        <ul>
            <li><a title="GitHub" href="https://github.com/williamgrimes/" rel="external"><span class="fa fa-github"></span></a></li>
            <li><a title="Stack Overflow" href="https://stackoverflow.com/users/2545164/william-grimes/" rel="external"><span class="fa fa-stack-overflow"></span></a></li>
            <!-- <li><a title="Google+" href="./" rel="external"><span class="fa fa-google-plus"></span></a></li> -->
            <li><a title="LinkedIn" href="https://www.linkedin.com/in/william-grimes/" rel="external"><span class="fa fa-linkedin"></span></a></li>
            <!-- <li><a title="Last.fm" href="./" rel="external"><span class="fa fa-lastfm"></span></a></li> -->
            <li><a title="RSS" href="/feed.xml" rel="external"><span class="fa fa-rss"></span></a></li>
        </ul>
    </div>

    <div id="menucont" class="bodycontainer clearfix">
        <div class="menutitle">
            <p><span class="fa fa-reorder"></span><strong>Menu</strong></p>
        </div>
        <ul class="menu">
            <li ><a title="Home" href="/"> &#187; Home</a></li>
            <li ><a title="Archives" href="/archives/"> &#187; Archives</a></li>
            
            <li ><a title="Tags" href="/tags/"> &#187; Tags</a></li>
            
            
            <li >
                <a href="/pages/cv/">&#187;  Curriculum Vitae</a>
            </li>
            
            <!-- <li><a title="RSS" href="/feed.xml">RSS</a></li> -->
        </ul>
    </div>
</div>

<div id="right" class="clearfix">
    
<div id="post">
    <div class="post-header">
    <div id="post-meta">
        <h1>Kobo - Annotation Extractor</h1>
        <br>
        <span class="date" style="font-variant-caps: small-caps;">17 January 2023</span>
        
    </div>
</div>
<div>
    <br/>
    
    <p>Electronic ink (e-ink) displays are composed of an array of tiny micro-capsules embedded in a layer between two electrodes. Each micro-capsule in the array contains both positively charged white particles, and negatively charged black particles. These particles are suspended in a transparent oil. When a voltage is applied across the micro-capsule, the black and white particles separate. With either the black particles or white particles moving to the top of the micro-capsule, creating a white or black dot depending on the charge [<sup id="fnref-1"><a class="footnote-ref" href="#fn-1">1</a></sup>].</p><div align="center"><img src="/img/e-ink.png" alt="Notifications" style="width:60%" /></div><center><b>Caption: </b> Schema of E ink microcapsules from a side view .</center><p></p><p>The array of micro-capsules together creates the appearance of text or images on the display, that is updated by changing the voltage over the electrodes. The particles in the micro-capsules remain in place even when the power is turned off, meaning that e-ink displays are able to hold their images even when not actively powered.</p><p>E-ink displays were developed by a company called the <em>E Ink Corporation</em>, founded in 1997 by a group of researchers from the Massachusetts Institute of Technology (MIT). The technology behind e-ink displays was based on a concept called "electrophoretic displays," which had been researched by several scientists in the 1970s and 1980s. <em>E Ink's</em> first commercial product was the "E Ink Vizplex", which was introduced in 2004 and used in the first generation of Amazon's Kindle e-reader [<sup id="fnref-2"><a class="footnote-ref" href="#fn-2">2</a></sup>]. Since the release of the Amazon Kindle in 2007 ebook readers have become increasingly prevalent. They confer many advantages for the reader:</p><ul><li>allowing many books to be carried on a single lightweight device,</li><li>easy purchasing and downloading of new books,</li><li>long battery life,</li><li>ability to waterproof the device,</li><li>ability to easily highlight text,</li><li>in built dictionaries to find the meaning of a word.</li></ul><p>Having recently switched from reading paper books to reading on an e-reader, it occurred to me that an additional advantage of reading on an electronic device is the data that is captured whilst reading. This project aims to make use of some of that data generated.</p><h2 id="manjushri-kobo">Manjushri Kobo</h2><p>This project is named after Manjushri a bodhisattva in Mahayana Buddhism associated with wisdom and learning. He is often depicted holding a sword and a book, symbolising the cutting of ignorance and the attainment of knowledge. Manjushri is considered to be the embodiment of the wisdom of all buddhas, and is often invoked in tantric practices for the attainment of higher wisdom and understanding. He is also one of the most revered and important figures in Tibetan Buddhism [<sup id="fnref-3"><a class="footnote-ref" href="#fn-3">3</a></sup>].</p><div align="center"><img src="/img/manjushri.jpg" alt="Notifications" style="width:30%" /></div><center><b>Caption: </b> Manjushri Thangka.</center><p></p><p>Manjushri is an appropriate name for this project that aims to make better use of annotations made on a Kobo, to aid learning. The objective is to extract multi-word annotations created on the Kobo Clara HD outputting a file of quotations, and for single words a vocabulary list with definitions that can be learned through Anki [<sup id="fnref-4"><a class="footnote-ref" href="#fn-4">4</a></sup>].</p><h2 id="overview">Overview</h2><p>The Github repository for the project is located here: <a href="https://github.com/williamgrimes/manjushri_kobo">manjushri_kobo</a>. At a high level the project is structured as follows, where main is the entry point for the project.</p><pre style="line-height:120%"><code>
    .
    ├── core
    │   ├── argparser.py
    │   ├── database.py
    │   ├── logs.py
    │   ├── quotes.py
    │   └── words.py
    ├── logs
    │   └── manjushri_kobo_<date>.log
    ├── main.py
    ├── README.md
    ├── requirements.txt
    ├── run_manjushri_kobo.sh
    └── sql
        ├── books_read.sql
        └── extract_annotations.sql
  </date></code></pre><p>The <code>argparser.py</code> module allows for passing arguments from the command line for example the location of the kobo <code>.sqlite</code> database, which is connected via a context manager in <code>database.py</code>. Logging is setup in the <code>logs.py</code> module.</p><p>A SQL query is run against the kobo database to extract all highlights made, which are split based on a <code>max_word_len</code> parameter into "quotes" and "words". Quotes are then extracted to an org-file in <code>quotes.py</code>. Finally words are cleaned and definitions found in <code>words.py</code> before being written to <code>.csv</code>.</p><h2 id="python-311">Python 3.11</h2><p>For this project I took the opportunity to try Python 3.11. This latest Python release includes significant performance increases being between 10-60% faster than Python 3.10 due to updates to CPython [<sup id="fnref-5"><a class="footnote-ref" href="#fn-5">5</a></sup>]. In addition to faster code execution, Python 3.11 brings:</p><ul><li>a faster start-up time,</li><li>more informative error tracebacks,</li><li>task and exception groups that simplify working with asynchronous code,</li><li>native support for working with TOML configuration files,</li><li>and, several new static typing support features [<sup id="fnref-6"><a class="footnote-ref" href="#fn-6">6</a></sup>].</li></ul><p>The most immediately obvious and welcome change is in more refined and specific error tracebacks introduced in PEP 657 [<sup id="fnref-7"><a class="footnote-ref" href="#fn-7">7</a></sup>]. In the example below the traceback shows the exact expression causing the error, instead of just the line in previous versions.</p><pre><code class="python">Traceback (most recent call last):
  File "distance.py", line 11, in &lt;module&gt;
    print(manhattan_distance(p1, p2))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "distance.py", line 6, in manhattan_distance
    return abs(point_1.x - point_2.x) + abs(point_1.y - point_2.y)
                           ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'x'
</code></pre><h2 id="quotes-and-org-mode">Quotes and Org-mode</h2><p>Org-mode is an open-source, plain-text outlining and note-taking tool for the Emacs text editor. It is built on top of the org-mode file format, which is a simple, plain-text format for organising notes, lists, and other information [<sup id="fnref-8"><a class="footnote-ref" href="#fn-8">8</a></sup>]. Org-mode provides a wide range of features for managing and organising information, including:</p><ul><li><strong>Outlining</strong>: org-mode allows you to create nested, hierarchical outlines of your notes and information.</li><li><strong>Todo Lists</strong>: You can easily create and manage to-do lists, with support for deadlines, priorities, and tags.</li><li><strong>Timestamps and Dates</strong>: org-mode allows you to assign timestamps and dates to your notes, making it easy to track when things were done or when they are due.</li><li><strong>Tags and Properties</strong>: org-mode allows you to assign tags and properties to your notes, making it easy to organise and search for specific information.</li><li><strong>Hyperlinks</strong> and Cross-referencing: org-mode supports hyperlinks and cross-referencing, allowing you to easily link to other notes, files, and websites.</li><li><strong>Document export</strong>: org-mode allows you to export your notes and outlines to a variety of formats, including HTML, LaTeX, and PDF.</li><li><strong>Customisable</strong>: org-mode is highly customizable and extensible, with a wide range of built-in commands and functions, as well as support for user-defined macros and scripts.</li></ul><p>In the <code>core/quotes.py</code> module I extract my annotations longer than 2 words to an org file called <code>book-annotations.org</code>. I particularly like this since org-mode provides a hierarchical approach making it easy to fold and unfold sections of the document.</p><div align="center"><img src="/img/book-annotations.png" alt="Book Annotations" style="width:100%" /></div><center><b>Caption: </b> Screenshot of extracted quotes in org-mode.</center><p></p><h2 id="words-natural-language-toolkit-nltk-and-anki">Words, Natural Language Toolkit (NLTK), and Anki</h2><p>For the task of looking up word definitions I tried using the Kobo proprietary Oxford Dictionary of English, but could not determine a way to query this through Python. So I then explored some python libraries for the task, namely:</p><ul><li><a href="https://pypi.org/project/PyDictionary/">PyDictionary</a>, and,</li><li><a href="https://github.com/Suyash458/WiktionaryParser">WiktionaryParser</a>.</li></ul><p>I decided not to use these since many words could not be found, and I wanted to avoid the dependency of an external request. After some experimentation WordNet from the NLTK [<sup id="fnref-9"><a class="footnote-ref" href="#fn-9">9</a></sup>] library gave the most succinct and reliable definitions.</p><p>The NLTK is an open-source library for natural language processing (NLP) in Python. NLTK provides a wide range of tools and resources for working with human language data, including: tokenization, part-of-speech tagging, parsing, named entity recognition (NER), sentiment analysis, text classification, stemming, and lemmatization.</p><p>WordNet is a lexical database for the English language that is included with the NLTK in Python. The WordNet lexical database groups words into sets of synonyms (synsets) and provides a hierarchy of concepts (taxonomy) to organize the synsets[<sup id="fnref-10"><a class="footnote-ref" href="#fn-10">10</a></sup>]. The NLTK library provides several functions for interacting with the WordNet database, such as looking up synonyms, antonyms, and definitions of words.</p><p>In the <code>core/words.py</code> module I use NLTK to clean words by:</p><ol><li>removing whitespace,</li><li>removing punctuation,</li><li>converting words to lower case, and</li><li>lemmatizing them.</li></ol><p>Then I use WordNet to lookup definitions, part of speech, and examples. These results are marked up with HTML tags and written to a csv file that can later be imported into Anki, for example a result in the csv file looks like this:</p><pre><code class="html">&lt;h1&gt;Portentous&lt;/h1&gt;,"
--------------------&lt;large&gt; 1 &lt;/large&gt;--------------------
&lt;em&gt;&lt;b&gt;
Of momentous or ominous significance; - herman melville&lt;/b&gt; - (Adjective Satellite)&lt;/em&gt;&lt;small&gt;&lt;u&gt;

Examples:&lt;/u&gt;
&lt;em&gt;""Such a portentous...monster raised all my curiosity""&lt;/em&gt;
&lt;em&gt;""A prodigious vision""&lt;/em&gt;
&lt;/small&gt;

--------------------&lt;large&gt; 2 &lt;/large&gt;--------------------
&lt;em&gt;&lt;b&gt;
Ominously prophetic&lt;/b&gt; - (Adjective Satellite)&lt;/em&gt;

--------------------&lt;large&gt; 3 &lt;/large&gt;--------------------
&lt;em&gt;&lt;b&gt;
Puffed up with vanity; ; ; ; - newsweek&lt;/b&gt; - (Adjective Satellite)&lt;/em&gt;&lt;small&gt;&lt;u&gt;

Examples:&lt;/u&gt;
&lt;em&gt;""A grandiloquent and boastful manner""&lt;/em&gt;
&lt;em&gt;""Overblown oratory""&lt;/em&gt;
&lt;em&gt;""A pompous speech""&lt;/em&gt;
&lt;em&gt;""Pseudo-scientific gobbledygook and pontifical hooey""&lt;/em&gt;
&lt;/small&gt;
-------------------------------------------"
</code></pre><p>This csv file can be imported into the Anki flashcards program to have a tool for memorising new vocabulary.</p><div align="center"><img src="/img/anki-import.png" alt="Anki Import" style="width:100%" /></div><center><b>Caption: </b> Importing csv file to Anki deck "English Vocabulary".</center><p></p><p>After importing the csv to an existing or newly created deck the words can be studied.</p><div align="center"><img src="/img/anki-portentous.png" alt="Anki Study" style="width:100%" /></div><center><b>Caption: </b> Viewing an Anki card.</center><p></p><h2 id="summary">Summary</h2><p>This short project I hope will be useful to get more value from reading on the Kobo, assisting in learning new vocabulary, and providing a reference library of quotes from books read. As e-ink displays slowly eat up the market I imagine more tools will become available for this, but I think using free and open source projects like Anki, and Org mode makes the outputs more generally useful.</p><p>In the future I might extend this project to include some reading statistics in the output logs. For example it would be interesting to log the books read, time spent reading broken down by month, fastest books read, words read per day, etcetera. The project could also be set to run directly when connected by setting a udev rule to launch the <code>run_manjushri_kobo.sh</code> bash script.</p><h2 id="references">References</h2><div class="footnotes"><hr /><ol><li id="fn-1"><p><a href="https://upload.wikimedia.org/wikipedia/commons/3/3a/Electronic_paper_%28Side_view_of_Electrophoretic_display%29_in_svg.svg">Wikimedia: Electronic paper - Side view of Electrophoretic display</a></p><a href="#fnref-1" class="footnote-backref">↩</a></li><li id="fn-2"><p><a href="https://en.wikipedia.org/wiki/E_Ink">Wikipedia: E Ink</a></p><a href="#fnref-2" class="footnote-backref">↩</a></li><li id="fn-3"><p><a href="https://en.wikipedia.org/wiki/Manjushri">Wikipedia: Manjushri</a></p><a href="#fnref-3" class="footnote-backref">↩</a></li><li id="fn-4"><p><a href="https://apps.ankiweb.net/">Anki</a></p><a href="#fnref-4" class="footnote-backref">↩</a></li><li id="fn-5"><p><a href="https://docs.python.org/3.11/whatsnew/3.11.html">Python Documentation: What’s New In Python 3.11</a></p><a href="#fnref-5" class="footnote-backref">↩</a></li><li id="fn-6"><p><a href="https://realpython.com/python311-new-features/#so-should-you-upgrade-to-python-311">RealPython: Python 3.11 New Features</a></p><a href="#fnref-6" class="footnote-backref">↩</a></li><li id="fn-7"><p><a href="https://peps.python.org/pep-0657/">PEP 657 – Include Fine Grained Error Locations in Tracebacks</a></p><a href="#fnref-7" class="footnote-backref">↩</a></li><li id="fn-8"><p><a href="https://orgmode.org/">Org-mode</a></p><a href="#fnref-8" class="footnote-backref">↩</a></li><li id="fn-9"><p><a href="https://www.nltk.org/">NLTK</a></p><a href="#fnref-9" class="footnote-backref">↩</a></li><li id="fn-10"><p><a href="https://wordnet.princeton.edu/">Wordnet</a></p><a href="#fnref-10" class="footnote-backref">↩</a></li></ol></div>
</div>

<div id="post-tags">
    <br/>
    <b>Tags: </b>
    
    <a href="/tags-output/kobo/">kobo</a>
    
    <a href="/tags-output/nltk/">nltk</a>
    
    <a href="/tags-output/python/">python</a>
    
</div>

<br/>

    <div id="prev-next">
        
        
        <a class="right button" href="/posts/2022-08-21-anacron-desktop-notifications/">Anacron Desktop Notifications &raquo;</a>
        
    </div>

    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = "http://williamgrimes.xyz/posts/2023-01-17-kobo-annotation-extractor/";
            this.page.identifier = "Kobo - Annotation Extractor";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//williamgrimes.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    


</div>

<hr/>
<div id="footercont" class="clearfix">Copyright &copy; 2023 William Grimes
    <p>Powered by <a href="http://cryogenweb.org">Cryogen</a></p>

</div>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="/js/highlight.pack.js" type="application/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/js/scripts.js" type="application/javascript"></script>


</body>
</html>
